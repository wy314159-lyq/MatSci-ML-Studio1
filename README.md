# MatSci-ML Studio: 智能材料科学机器学习平台

**MatSci-ML Studio** 是一个集成化的、图形用户界面（GUI）驱动的机器学习平台，专为材料科学及其他领域的科研人员和工程师设计。它提供了一个从数据处理到模型训练、预测、优化和可解释性分析的端到端工作流，旨在降低机器学习的应用门槛，加速新材料的发现和性能优化。

## ✨ 项目特色

*   **模块化工作流**: 清晰地划分了数据管理、特征工程、模型训练、预测和优化等多个阶段，符合科研的逻辑流程。
*   **图形化界面 (GUI)**: 所有操作均可通过直观的图形界面完成，无需编写复杂的代码。
*   **智能化向导**: 内置智能分析与推荐系统，可自动评估数据质量并推荐合适的预处理、特征选择和模型配置。
*   **高级优化算法**: 集成了遗传算法、粒子群优化、贝叶斯优化以及多目标优化（NSGA-II, MOEA/D 等），用于目标性能的反向设计和优化。
*   **模型可解释性**: 提供了基于 SHAP (SHapley Additive exPlanations) 的模型解释功能，帮助用户理解模型的决策过程。
*   **全面的预处理**: 支持高级异常值检测、智能缺失值填充、数据变换和特征缩放。
*   **协作与版本控制**: 内置项目管理和版本快照功能，便于团队协作和实验追溯。
*   **实时性能监控**: 实时监控系统资源占用和任务进度，确保流畅的运行体验。

---

## 📚 模块详解

本项目由以下核心模块构成，每个模块都可以在主界面的标签页中找到：

1.  [**📊 数据管理 (Data Management)**](#-模块一数据管理与预处理)
2.  [**🧬 高级预处理 (Advanced Preprocessing)**](#-模块二高级数据预处理)
3.  [**🎯 特征选择 (Feature Selection)**](#-模块三特征工程与选择)
4.  [**🔬 模型训练 (Model Training)**](#-模块四模型训练与评估)
5.  [**🧠 SHAP 分析 (SHAP Analysis)**](#-模块五shap-模型可解释性分析)
6.  [**🎯 目标优化 (Target Optimization)**](#-模块六目标属性优化)
7.  [**🔄 多目标优化 (Multi-Objective Optimization)**](#-模块七多目标优化)
8.  [**🤖 主动学习 (Active Learning)**](#-模块八主动学习与优化)
9.  [**💡 智能向导 (Intelligent Wizard)**](#-模块九智能向导)
10. [**⚙️ 性能监控 (Performance Monitor)**](#-模块十性能监控)
11. [**🤝 协作与版本控制 (Collaboration)**](#-模块十一协作与版本控制)
12. [**✅ 模型预测 (Prediction)**](#-模块十二模型预测与结果导出)

---

### 📊 模块一：数据管理与预处理

这是整个工作流的起点，负责数据的导入、探索、清洗和初步准备。

*   **核心功能**:
    *   **数据导入**: 支持从 CSV、Excel 文件以及系统剪贴板导入数据。
    *   **数据探索**: 提供数据概览（形状、类型、缺失值）和表格预览。
    *   **数据可视化**: 自动生成数据质量报告，包括缺失值热图、分布图、相关性矩阵等，帮助用户直观理解数据。
    *   **数据清洗**: 提供缺失值处理（删除、均值/中位数/众数填充）和重复行移除功能。
    *   **特征/目标选择**: 用户可以通过界面选择用于建模的特征列（X）和目标列（y）。
    *   **类型推荐**: 根据目标列的特性，自动推荐任务类型（分类或回归）。
    *   **分类特征编码**: 支持对分类特征进行独热编码（One-Hot）、标签编码（Label Encoding）等。

*   **核心类**: `DataModule(QWidget)`

---

### 🧬 模块二：高级数据预处理

本模块提供了一系列高级的数据清洗和变换工具，用于提升数据质量。

*   **核心功能**:
    *   **智能推荐系统**: 内置 `SmartRecommendationEngine`，可自动分析数据质量并推荐合适的预处理步骤。
    *   **高级异常值检测**: 集成了多种异常值检测算法，如 `IQR`, `Z-Score`, `Isolation Forest`, `Local Outlier Factor` 等，并提供可视化。
    *   **智能缺失值填充**: 除了基础填充方法，还支持 `KNNImputer` 和 `IterativeImputer` 等高级填充策略。
    *   **数据变换**: 提供 `StandardScaler`, `MinMaxScaler`, `PowerTransformer` 等多种数据缩放和变换工具，以满足不同模型的需求。
    *   **状态管理与历史记录**: `StateManager` 和 `OperationHistory` 实现了强大的撤销/重做功能和详细的操作日志，确保所有预处理步骤都可追溯。

*   **核心类**: `AdvancedPreprocessing(QWidget)`, `OutlierDetector`, `SmartImputer`, `StateManager`

---

### 🎯 模块三：特征工程与选择

此模块专注于从原始特征中筛选出对模型最有价值的子集，以提高模型性能并降低过拟合风险。

*   **核心功能**:
    *   **多阶段选择策略**: 实现了"重要性过滤" -> "相关性过滤" -> "高级搜索"的多阶段特征选择流程。
    *   **模型驱动的重要性评估**: 使用机器学习模型（如随机森林）来计算特征的重要性得分，并据此进行筛选。
    *   **相关性分析**: 自动检测并移除高度相关的冗余特征，提供过滤前后的相关性矩阵对比图。
    *   **高级子集搜索**:
        *   **序列特征选择 (SFS)**: 支持前向和后向的贪心搜索策略。
        *   **遗传算法 (GA)**: 通过模拟生物进化过程来搜索最优的特征组合。
        *   **穷举搜索**: 对特征子集进行暴力搜索（适用于特征数量较少的情况）。
    *   **并行计算**: 利用 `ThreadPoolExecutor` 和 `ProcessPoolExecutor` 加速计算密集型的特征评估过程。

*   **核心类**: `FeatureModule(QWidget)`, `FeatureSelectionWorker(QThread)`

---

### 🔬 模块四：模型训练与评估

这是机器学习流程的核心，负责使用处理好的数据来训练模型，并对其性能进行全面评估。

*   **核心功能**:
    *   **丰富的模型库**: 通过 `ml_utils` 提供了全面的分类和回归模型库，包括线性模型、SVM、树模型、集成模型（随机森林、梯度提升）、神经网络等。
    *   **自动化预处理管道**: 自动为数值和分类特征构建 `sklearn.pipeline.Pipeline`，集成了缺失值填充、缩放和编码。
    *   **超参数优化 (HPO)**: 支持网格搜索、随机搜索和贝叶斯搜索等多种方法，自动寻找模型的最佳参数。
    *   **可靠的性能评估**: 提供多种评估策略，包括单次划分、多次随机划分和嵌套交叉验证，以获得模型性能的无偏估计。
    *   **全面的评估指标与可视化**: 自动计算并展示各种指标（如 R², MSE, Accuracy, F1-Score, ROC AUC），并生成混淆矩阵、ROC曲线、残差图等多种可视化图表。
    *   **模型持久化**: 支持将训练好的完整管道（包含预处理器和模型）保存为 `.joblib` 文件，以便在预测模块中复用。

*   **核心类**: `TrainingModule(QWidget)`

---

### 🧠 模块五：SHAP 模型可解释性分析

此模块利用 SHAP (SHapley Additive exPlanations) 框架，为训练好的“黑箱”模型提供深入、直观的解释。

*   **核心功能**:
    *   **自动选择解释器**: 根据模型类型（树模型、线性模型等）自动选择最合适的 SHAP 解释器（`TreeExplainer`, `KernelExplainer` 等）。
    *   **全局解释**:
        *   **Summary Plot / Beeswarm Plot**: 直观展示每个特征对模型输出的总体影响方向和大小。
        *   **Feature Importance**: 以条形图形式清晰地展示特征的平均重要性排序。
    *   **局部解释**:
        *   **Waterfall Plot**: 详细分解单个样本的预测值，展示每个特征如何将其从基线值推向最终预测值。
        *   **Force Plot**: 直观地展示哪些特征是推动或拉低单个样本预测值的主要力量。
    *   **特征依赖图 (Dependence Plots)**: 揭示单个特征的边际效应对模型输出的影响，并能自动发现和可视化与其他特征的交互效应。
    *   **独立可视化窗口**: 解决 Matplotlib 与 PyQt 的兼容性问题，所有 SHAP 图都可以在独立的、可交互的窗口中打开和导出。

*   **核心类**: `SHAPAnalysisModule(QWidget)`, `SHAPCalculationWorker(QThread)`

---

### 🎯 模块六：目标属性优化

这是一个强大的反向设计工具，用于寻找能使材料达到特定目标属性的最佳特征组合。

*   **核心功能**:
    *   **多种优化算法**: 集成了遗传算法（GA）、粒子群优化（PSO），以及多种 `scipy` 和 `scikit-optimize` 中的高级优化器（如差分进化、贝叶斯优化）。
    *   **约束优化**: 支持用户定义特征变量的边界约束和线性/非线性约束。
    *   **实时可视化**: 在优化过程中，实时绘制收敛曲线和参数空间探索图，让用户可以监控优化进程。
    *   **线程安全**: 所有计算密集型优化任务都在独立的 `QThread` 中运行，保证了GUI的流畅响应，并支持中断操作。

*   **核心类**: `TargetOptimizationModule(QWidget)`, `OptimizationWorker(QThread)`

---

### 🔄 模块七：多目标优化

当需要同时优化多个相互冲突的目标（例如，同时提高强度和韧性）时，此模块可以找到一系列代表“最佳权衡”的帕累托前沿（Pareto Front）解。

*   **核心功能**:
    *   **强大的优化库**: 基于 `pymoo` 库，支持 `NSGA-II`, `NSGA-III`, `SPEA2`, `MOEA/D` 等业界领先的多目标优化算法。
    *   **混合变量处理**: 内置自定义的采样（`MixedVariableSampling`）和修复（`EnhancedBoundaryRepair`）算子，原生支持连续、整数、二元和分类等混合类型的特征变量。
    *   **鲁棒性与约束处理**: 提供了鲁棒优化（`RobustOptimizationHandler`）和显式约束处理（`ExplicitConstraintHandler`）等高级功能。
    *   **实时监控与可视化**: 通过自定义的回调函数（`OptimizationCallback`）实时更新帕累托前沿图和收敛指标（如超体积）。
    *   **检查点机制**: 支持在优化过程中自动保存检查点（`OptimizationCheckpoint`），便于从中断处恢复。

*   **核心类**: `MultiObjectiveOptimizationModule(QWidget)`, `MLProblem(Problem)`

---

### 🤖 模块八：主动学习与优化

此模块将机器学习与实验设计相结合，通过智能推荐系统指导下一次“最值得做”的实验，从而以最少的实验次数找到最优解。

*   **核心功能**:
    *   **智能体模型库**: 集成了多种强大的代理模型（`RandomForest`, `XGBoost`, `GaussianProcess`等），用于学习和预测目标属性。
    *   **多种采集函数**: 支持期望提升（Expected Improvement）和置信上界（Upper Confidence Bound）等多种经典的采集函数，以平衡探索（Exploration）和利用（Exploitation）。
    *   **候选集生成**: 提供拉丁超立方、Sobol序列、网格搜索等多种方法来生成候选实验空间。
    *   **迭代式学习**: 整个模块围绕“推荐-反馈-再学习”的闭环进行设计，`ActiveLearningSession` 类用于管理整个迭代过程。
    *   **全面的过程可视化**: 实时绘制学习曲线、特征重要性演化图和探索-利用平衡图，帮助用户理解主动学习的每一步。

*   **核心类**: `ActiveLearningWindow(QMainWindow)`, `ActiveLearningOptimizer`

---

### 💡 模块九：智能向导

此模块充当用户的智能助手，通过自动化的数据分析，为后续的预处理和建模步骤提供智能化的配置建议。

*   **核心功能**:
    *   **自动化数据分析**: `DataAnalysisWorker` 线程在后台对数据进行全面的统计和质量评估。
    *   **多维度质量评估**: 从完整性、唯一性、有效性、一致性和相关性等多个维度对数据质量进行打分。
    *   **智能推荐**: 基于分析结果，自动推荐最佳的缺失值处理方法、异常值检测策略、特征选择方法和模型选择。
    *   **一键应用**: 用户可以一键采纳向导的推荐配置，并将其自动应用到后续的相关模块中。

*   **核心类**: `IntelligentWizard(QWidget)`, `DataAnalysisWorker(QThread)`

---

### ⚙️ 性能监控

这是一个实时监控工具，用于跟踪应用程序的系统资源占用和后台任务的执行进度。

*   **核心功能**:
    *   **系统资源监控**: `SystemMonitorWorker` 利用 `psutil` 库实时监控 CPU、内存、磁盘和网络的使用情况。
    *   **任务进度跟踪**: `TaskProgressTracker` 能够跟踪长时间运行的任务（如特征选择、模型训练）的进度、耗时和状态。
    *   **实时图表**: 将系统性能数据以实时更新的图表形式展示，便于用户了解系统负载。
    *   **性能警报**: 当CPU或内存使用率过高时，会发出警报，提醒用户可能存在的性能瓶颈。

*   **核心类**: `PerformanceMonitor(QWidget)`, `SystemMonitorWorker(QThread)`

---

### 🤝 协作与版本控制

此模块为团队协作和实验管理提供了基础支持。

*   **核心功能**:
    *   **项目管理**: 支持创建、打开和删除项目，每个项目都有独立的目录结构来存放数据、模型和结果。
    *   **版本快照**: `VersionControl` 类允许用户为项目的当前状态（包括数据和模型）创建一个带有描述信息的“快照”。
    *   **历史追溯**: 所有版本快照都会被记录下来，用户可以随时查看和回顾之前的实验状态。
    *   **项目导出**: 支持将整个项目打包成一个 `.zip` 文件，方便分享和迁移。

*   **核心类**: `CollaborationWidget(QWidget)`, `ProjectManager`, `VersionControl`

---

### ✅ 模块十二：模型预测与结果导出

此模块用于加载已经训练好的模型，对新数据进行预测，并导出结果。

*   **核心功能**:
    *   **模型加载**: 支持加载当前会话中训练的模型，或从 `.joblib` 文件加载持久化的模型。
    *   **详细的模型信息**: 加载模型后，会自动解析并显示模型的类型、参数、特征名称、预处理步骤等详细元数据。
    *   **双重预测模式**:
        *   **批量预测**: 支持从文件或剪贴板导入批量数据进行预测。
        *   **手动输入**: 自动根据模型的特征生成输入界面，用户可以手动输入单一样本的特征值进行实时预测。
    *   **结果导出**: 支持将带有预测结果的数据导出为 CSV 或 Excel 文件。

*   **核心类**: `PredictionModule(QWidget)`
### 🚀 推荐工作流 (Recommended Workflow)

为了充分利用 MatSci-ML Studio 的全部功能，我们推荐用户遵循以下工作流程。这个流程与主界面上模块标签页的排列顺序基本一致，旨在引导您从数据到洞见的完整旅程。

1.  **数据导入与探索 (在 `Data Management` 模块)**
    *   **起点**: 一切从这里开始。使用 `Browse` 或 `From Clipboard` 按钮导入您的原始数据集。
    *   **探索**: 在右侧的 "Data Overview" 和 "Data Quality" 标签页中，仔细查看数据的基本信息、预览数据内容、检查缺失值和数据分布情况。
    *   **初步清洗**: 使用 "Data Cleaning" 部分的功能处理明显的缺失值和重复数据。
    *   **定义任务**: 在 "Feature & Target Selection" 部分，选择您的特征 (X) 和目标 (y)。系统将自动推荐任务类型（分类/回归）。
    *   **编码 (可选)**: 如果数据中包含非数值类型的分类特征，使用 "Categorical Feature Encoding" 功能进行编码。

2.  **数据深度处理 (在 `Advanced Preprocessing` 或 `Intelligent Wizard` 模块)**
    *   **智能向导**: 如果不确定如何处理数据，可以切换到 `Intelligent Wizard` 模块，运行智能分析，它会为您提供一套完整的预处理和建模建议。
    *   **手动高级处理**: 或者，在 `Advanced Preprocessing` 模块中，您可以手动执行更高级的操作，如使用多种高级算法检测和处理异常值。

3.  **特征筛选 (在 `Feature Selection` 模块)**
    *   **降维**: 将经过预处理的数据载入此模块。通过配置多阶段的特征选择策略（如重要性过滤、相关性过滤和高级搜索），剔除冗余或无关的特征，以提升模型性能。

4.  **模型训练 (在 `Model Training` 模块)**
    *   **核心步骤**: 使用筛选后的特征集来训练机器学习模型。
    *   **选择模型**: 根据您的任务类型，选择一个或多个候选模型。
    *   **超参数优化 (可选)**: 启用 HPO (Hyperparameter Optimization) 来自动寻找模型的最佳参数组合。
    *   **评估**: 模型训练完成后，在右侧的 "Metrics"、"Confusion Matrix" 等标签页中全面评估模型性能。
    *   **保存模型**: 对结果满意后，点击 `Save Model` 将训练好的完整管道保存下来。

5.  **模型应用与探索 (多模块并行)**
    *   一旦有了训练好的模型，您可以根据需求进入以下任何一个模块：
    *   **模型预测 (`Prediction`)**: 加载模型，对新的未知数据进行预测。
    *   **模型解释 (`SHAP Analysis`)**: 加载模型和数据，深入理解模型为什么会做出这样的预测，分析特征的影响力。
    *   **目标优化 (`Target Optimization` / `Multi-Objective Optimization`)**: 如果您的目标是“反向设计”（即寻找能产生特定性能的配方或参数），请使用这两个模块。加载模型，设定您的优化目标和约束条件，算法将为您搜索最优的特征组合。
    *   **主动学习 (`Active Learning`)**: 如果您的目标是“指导下一次实验”，请使用此模块。它会基于当前模型，推荐最具有信息价值的“下一个实验点”，帮助您用最少的实验次数达到目标。

6.  **项目管理与监控 (贯穿始终)**
    *   **协作与版本控制 (`Collaboration`)**: 在项目的任何关键阶段，您都可以使用此模块创建“快照”，保存当前的工作状态，便于版本控制和团队分享。
    *   **性能监控 (`Performance Monitor`)**: 在执行任何计算密集型任务（如训练、优化）时，可以随时切换到此模块查看系统资源占用情况。

---

### 🛠️ 核心工具与辅助模块 (Core Utilities & Helper Modules)

除了用户直接交互的GUI模块外，本项目还包含一系列在后台提供支撑的核心工具和辅助模块。这部分主要面向希望理解项目底层逻辑或进行二次开发的开发者。

*   **`main_window.py`**
    *   **角色**: 应用程序的主入口和框架。
    *   **职责**: 负责创建主窗口，初始化并容纳所有功能模块的标签页 (`QTabWidget`)，并建立各个模块之间的信号-槽连接（`connect_modules`），确保数据和状态可以在不同模块间顺畅流动。

*   **`ml_utils.py`**
    *   **角色**: 机器学习的“核心大脑”。
    *   **职责**: 封装了所有底层的机器学习逻辑。它定义了平台支持的`sklearn`模型库 (`get_available_models`)，提供默认的超参数范围 (`get_default_hyperparameters`)，并包含模型评估 (`evaluate_*_model`) 和预处理管道创建 (`create_preprocessing_pipeline`) 等核心函数。

*   **`data_utils.py` & `plot_utils.py`**
    *   **角色**: 数据和可视化的基础工具库。
    *   **职责**: `data_utils.py` 封装了所有数据导入和基础质量检查的功能。`plot_utils.py` 则提供了一系列标准化的绘图函数，确保整个应用的可视化风格统一且代码可复用。

*   **`feature_name_utils.py` & `prediction_utils.py`**
    *   **角色**: 特征名称映射与管理系统。
    *   **职责**: 这是处理复杂特征（特别是经过独热编码后的特征）的关键。`FeatureNameMapper` 类负责跟踪原始特征与其编码后名称之间的映射关系。这使得SHAP分析和手动预测等模块依然能够使用人类可读的原始特征名，极大地提升了用户体验和结果的可解释性。

*   **`shap_visualization_windows.py`**
    *   **角色**: SHAP可视化的独立渲染解决方案。
    *   **职责**: 为了解决 `matplotlib` 与 `PyQt` 在某些环境下（特别是在后台线程中）的兼容性问题，该文件定义了独立的 `QDialog` 窗口。当用户需要查看SHAP图时，程序会创建一个新的独立窗口来渲染和显示图像，确保了主界面的稳定性和响应性。

*   **`EnhancedVisualizations` (在 `active_learning_optimizer.py` 中)**
    *   **角色**: 主动学习模块的专属可视化工具。
    *   **职责**: 虽然不是一个顶层模块，但它为 `ActiveLearningWindow` 提供了多种高级的可视化图表，如PCA降维分析、不确定性分析、设计空间切片和优化历史等，是主动学习模块能够提供深度洞察的关键。


## 🚀 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 启动应用程序

```bash
python main.py
```



## 🔧 系统要求

- Python 3.7+
- PyQt5 5.15.0+
- 科学计算库：NumPy、Pandas、SciPy
- 机器学习库：scikit-learn、XGBoost、LightGBM、CatBoost
- 可视化库：Matplotlib、Seaborn
- 模型解释库：SHAP

## 📄 许可证

[MIT License](LICENSE)

## 📞 联系方式

如有问题或建议，请联系：1255201958@qq.com 